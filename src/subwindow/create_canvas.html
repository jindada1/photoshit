<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>创建新作品</title>
    <link rel="stylesheet" type="text/css" href="../cdn/element-ui/element.css">
</head>
<style>
    .ps-dialog__header {
        padding: 20px 20px 10px;
        display: flex;
        align-items: baseline;
        -webkit-app-region: drag;
    }

    .ps-dialog__title {
        line-height: 24px;
        font-size: 18px;
        color: #303133;
        flex: 1;
    }

    .ps-dialog__titlebtn {
        border: none;
        padding: 0;
        -webkit-app-region: no-drag;
    }

    .ps-dialog__body {
        padding: 0 20px;
        color: #606266;
        font-size: 14px;
        word-break: break-all;
        height: 370px;
    }

    .ps-dialog__footer {
        padding: 10px 20px 20px;
        text-align: right;
        box-sizing: border-box;
    }

    .el-form-item {
        margin-bottom: 12px;
    }

    .el-input-group__append {
        background-color: white;
        color: black;
        width: 50px;
    }

    .el-tabs__content {
        height: 310px;
        overflow-y: auto;
    }

    .el-tabs__content::-webkit-scrollbar {
        width: 0px;
    }

    #dropZone {
        height: 200px;
        text-align: center;
        border-radius: 4px;
        border: #9e9e9e 2px dashed;
        line-height: 200px;
    }

    .ps-center-img {
        max-width: 100%;
        max-height: 100%;
        vertical-align: middle;
        display: inline-block;
    }
</style>

<body>
    <div id="app">
        <div class="ps-dialog__header">
            <span class="ps-dialog__title">创建新画布</span>
            <el-button class="ps-dialog__titlebtn" plain icon="el-icon-close" @click="close"></el-button>
        </div>
        <div class="ps-dialog__body">
            <el-tabs v-model="createType">
                <el-tab-pane label="画板" name="board">
                    <el-form ref="canvasConfigForm" :model="canvas" label-position="left" label-width="80px"
                        hide-required-asterisk>
                        <el-divider content-position="center">尺寸</el-divider>
                        <el-form-item label="水平长度">
                            <el-input placeholder="请输入画布长度" v-model="canvas.width" :onkeyup="this.numberFilter()">
                                <el-select v-model="canvas.unit" placeholder="单位" slot="append">
                                    <el-option v-for="unit in units" :key="unit" :label="unit" :value="unit">
                                    </el-option>
                                </el-select>
                            </el-input>
                        </el-form-item>
                        <el-form-item label="竖直高度">
                            <el-input placeholder="请输入画布高度" v-model="canvas.height" :onkeyup="this.numberFilter()">
                                <el-select v-model="canvas.unit" placeholder="单位" slot="append">
                                    <el-option v-for="unit in units" :key="unit" :label="unit" :value="unit">
                                    </el-option>
                                </el-select>
                            </el-input>
                        </el-form-item>
                        <el-divider content-position="center">底色</el-divider>
                        <el-form-item label="颜色选择">
                            <el-col :span="4">
                                <el-color-picker size="medium" v-model="canvas.undercolor" show-alpha
                                    :predefine="predefineColors">
                                </el-color-picker>
                            </el-col>
                            <el-col :span="20"> {{canvas.undercolor}} </el-col>
                        </el-form-item>
                    </el-form>
                </el-tab-pane>
                <el-tab-pane label="图片" name="image">
                    <div id="dropZone">
                        <div v-if="!image.path" style="text-align: center;">将图片拖拽到此处（jpg/png）</div>
                        <img v-else :src="image.path" class="ps-center-img">
                    </div>
                    <div style="margin: 10px 0;">
                        <el-button @click="openBrowser" type="primary" icon="el-icon-folder-opened" plain>浏览本地文件
                        </el-button>
                        <el-button style="float: right;" type="primary" icon="el-icon-link" plain>从下方链接中导入</el-button>
                    </div>
                    <div>
                        <el-input v-model="image.url" placeholder="要导入的图片链接"></el-input>
                    </div>
                </el-tab-pane>
                <el-tab-pane label="模板" name="template">模板</el-tab-pane>
                <el-tab-pane label="实时上传" name="upload">实时上传</el-tab-pane>
            </el-tabs>
        </div>
        <div class="ps-dialog__footer">
            <div slot="footer" class="dialog-footer">
                <el-button @click="close">取 消</el-button>
                <el-button type="primary" @click="createNew">创 建</el-button>
            </div>
        </div>
    </div>
    </div>
</body>
<!-- import Vue before Element -->
<script src="../cdn/vue.js"></script>
<!-- import JavaScript -->
<script src="../cdn/element-ui/element.js"></script>

<script>
    const { remote } = require('electron');
    const ipcRenderer = require('electron').ipcRenderer

    const createTypes = {
        board: 'board',
        image: 'image',
        template: 'template',
        upload: 'upload',
    }

    new Vue({
        el: '#app',
        data: function () {
            return {
                createType: createTypes.image,
                canvas: {
                    width: "",
                    height: "",
                    rateLocked: false,
                    unit: 'px',
                    undercolor: '#ffffff',
                },
                units: ['px'],
                predefineColors: [
                    '#ffffff',
                    '#ff4500',
                    '#ff8c00',
                    '#ffd700',
                    '#90ee90',
                    '#00ced1',
                    '#1e90ff',
                    '#c71585',
                    '#000000',
                    'rgba(255, 255, 255, 0)',
                ],
                image: {
                    path: null,
                    url: null
                },
            }
        },
        methods: {
            //关闭
            close() {
                remote.getCurrentWindow().close();
            },
            openBrowser() {
                ipcRenderer.send('open-imagefile');
            },
            loadImage(image) {
                this.image.path = image;
            },
            enableDragIn() {
                var dropZone = document.getElementById('dropZone');
                var originBorder = dropZone.style.border;
                var highlightBorder = "#1989fa 2px dashed";
                var _this = this

                dropZone.addEventListener('dragover', function (evt) {
                    evt.stopPropagation();
                    evt.preventDefault();
                    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
                    var originBorder = dropZone.style.border;
                    dropZone.style.border = highlightBorder;
                }, false);

                dropZone.addEventListener("dragleave", function (evt) {
                    evt.preventDefault();
                    evt.stopPropagation();
                    dropZone.style.border = originBorder;
                }, false);

                dropZone.addEventListener('drop', function (evt) {
                    evt.stopPropagation();
                    evt.preventDefault();
                    dropZone.style.border = originBorder;
                    var files = evt.dataTransfer.files;

                    if (files.length) {
                        if(files[0].type == "image/jpeg" || files[0].type == "image/png")
                            _this.loadImage(files[0].path);
                    }
                }, false);
            },
            numberFilter(e) {
                this.canvas.width = this.canvas.width.replace(/[^\d.]/g, '');
                this.canvas.height = this.canvas.height.replace(/[^\d.]/g, '')
            },
            createboard() {
                // this.$refs.canvasConfigForm.validate((success, failed) => {
                //     console.log(success);
                // });
                console.log(this.createType)
                return 1
            },
            createNew() {
                let result = undefined;

                switch (this.createType) {
                    case createTypes.board:
                        result = this.createboard()
                        break;
                    case createTypes.image:
                        // code block
                        break;
                    case createTypes.template:
                        // code block
                        break;
                    case createTypes.upload:
                        // code block
                        break;
                }

                if (result) {
                    ipcRenderer.send('create-canvas', result);
                    self.close();
                }
                else console.log(result)
            }
        },
        mounted() {
            this.enableDragIn();
            let _this = this;
            ipcRenderer.on('open-image', (event, image) => {
                _this.loadImage(image);
            })
        }
    })
</script>

</html>